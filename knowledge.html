<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyChat - ×××’×¨ ××™×“×¢</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    <script>
        tailwind.config = {
            theme: { extend: { colors: { primary: '#6366f1', 'primary-dark': '#4f46e5', secondary: '#8b5cf6', dark: '#0f172a', success: '#10b981', warning: '#f59e0b', danger: '#ef4444' } } }
        }
    </script>
    <style>
        * { font-family: 'Heebo', sans-serif; }
        body { background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%); min-height: 100vh; }
        .glass { background: rgba(255,255,255,0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.08); }
        .glass-light { background: rgba(255,255,255,0.95); backdrop-filter: blur(20px); }
        .gradient-primary { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); }
        .gradient-success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .gradient-glow { box-shadow: 0 0 40px rgba(99, 102, 241, 0.3); }
        .card-modern { background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.06); border-radius: 24px; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .card-modern:hover { background: rgba(255,255,255,0.05); border-color: rgba(99, 102, 241, 0.3); transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .sidebar-modern { background: linear-gradient(180deg, rgba(15,23,42,0.98) 0%, rgba(30,41,59,0.98) 100%); border-left: 1px solid rgba(255,255,255,0.06); }
        .sidebar-item { transition: all 0.3s ease; border-radius: 16px; }
        .sidebar-item:hover { background: rgba(99, 102, 241, 0.1); }
        .sidebar-item.active { background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%); border: 1px solid rgba(99, 102, 241, 0.3); }
        .btn-modern { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); border-radius: 16px; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4); }
        .btn-modern:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(99, 102, 241, 0.5); }
        .btn-outline { background: transparent; border: 2px solid rgba(99, 102, 241, 0.5); border-radius: 16px; color: #a5b4fc; transition: all 0.3s ease; }
        .btn-outline:hover { background: rgba(99, 102, 241, 0.1); border-color: #6366f1; }
        .input-modern { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; color: white; transition: all 0.3s ease; }
        .input-modern:focus { background: rgba(255,255,255,0.05); border-color: #6366f1; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); outline: none; }
        .input-modern::placeholder { color: rgba(255,255,255,0.4); }
        .badge { padding: 6px 14px; border-radius: 30px; font-size: 12px; font-weight: 600; }
        .badge-pricing { background: rgba(16, 185, 129, 0.15); color: #34d399; }
        .badge-services { background: rgba(99, 102, 241, 0.15); color: #a5b4fc; }
        .badge-hours { background: rgba(245, 158, 11, 0.15); color: #fbbf24; }
        .badge-location { background: rgba(236, 72, 153, 0.15); color: #f472b6; }
        .badge-terms { background: rgba(239, 68, 68, 0.15); color: #f87171; }
        .badge-faq { background: rgba(6, 182, 212, 0.15); color: #22d3ee; }
        .badge-other { background: rgba(148, 163, 184, 0.15); color: #cbd5e1; }
        .modal-overlay { background: rgba(0,0,0,0.7); backdrop-filter: blur(8px); }
        .modal-content { animation: modalIn 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.9) translateY(40px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        .stat-card { background: linear-gradient(135deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%); }
        .pulse-glow { animation: pulseGlow 2s infinite; }
        @keyframes pulseGlow { 0%, 100% { box-shadow: 0 0 5px rgba(16, 185, 129, 0.5); } 50% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.8); } }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.02); }
        ::-webkit-scrollbar-thumb { background: rgba(99, 102, 241, 0.3); border-radius: 3px; }
        .toggle-modern { position: relative; width: 56px; height: 28px; background: rgba(255,255,255,0.1); border-radius: 14px; cursor: pointer; transition: all 0.3s ease; }
        .toggle-modern.active { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .toggle-modern::after { content: ''; position: absolute; top: 3px; left: 3px; width: 22px; height: 22px; background: white; border-radius: 50%; transition: transform 0.3s ease; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .toggle-modern.active::after { transform: translateX(28px); }
    </style>
</head>
<body>
    <div id="toast-container" class="fixed top-4 left-4 z-50 flex flex-col gap-2"></div>
    
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <aside class="sidebar-modern w-72 fixed h-full z-40">
            <div class="p-6 border-b border-white/5">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 gradient-primary rounded-2xl flex items-center justify-center gradient-glow">
                        <i data-lucide="message-square" class="w-6 h-6 text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-white">EasyChat</h1>
                        <p class="text-xs text-gray-400">× ×™×”×•×œ ×‘×•×˜ ×—×›×</p>
                    </div>
                </div>
            </div>
            
            <nav class="p-4 space-y-2">
                <a href="conversations.html" class="sidebar-item flex items-center gap-4 px-5 py-4 text-gray-300 hover:text-white">
                    <i data-lucide="message-circle" class="w-5 h-5"></i>
                    <span class="font-medium">×©×™×—×•×ª</span>
                </a>
                <a href="knowledge.html" class="sidebar-item active flex items-center gap-4 px-5 py-4 text-white">
                    <i data-lucide="brain" class="w-5 h-5"></i>
                    <span class="font-medium">×××’×¨ ××™×“×¢</span>
                </a>
                <a href="settings.html" class="sidebar-item flex items-center gap-4 px-5 py-4 text-gray-300 hover:text-white">
                    <i data-lucide="settings" class="w-5 h-5"></i>
                    <span class="font-medium">×”×’×“×¨×•×ª</span>
                </a>
            </nav>
            
            <div class="absolute bottom-0 w-full p-4 border-t border-white/5">
                <div class="glass rounded-2xl p-4">
                    <div class="flex items-center gap-3">
                        <div class="w-3 h-3 bg-emerald-500 rounded-full pulse-glow"></div>
                        <div>
                            <p class="text-sm font-medium text-white">×‘×•×˜ ×¤×¢×™×œ</p>
                            <p class="text-xs text-gray-400">WhatsApp ××—×•×‘×¨</p>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="flex-1 mr-72 p-8">
            <!-- Header -->
            <header class="flex items-center justify-between mb-8" id="header">
                <div>
                    <h2 class="text-3xl font-bold text-white mb-2">×××’×¨ ××™×“×¢ ğŸ§ </h2>
                    <p class="text-gray-400">×œ××“ ××ª ×”×‘×•×˜ ×œ×¢× ×•×ª ×¢×œ ×©××œ×•×ª ×”×œ×§×•×—×•×ª ×©×œ×š</p>
                </div>
                <div class="flex gap-3">
                    <button onclick="openBulkModal()" class="btn-outline px-6 py-3 flex items-center gap-2">
                        <i data-lucide="wand-2" class="w-5 h-5"></i>
                        ×™×™×‘×•× ××”×™×¨
                    </button>
                    <button onclick="openModal()" class="btn-modern text-white px-6 py-3 flex items-center gap-2">
                        <i data-lucide="plus" class="w-5 h-5"></i>
                        ×”×•×¡×£ ×©××œ×”
                    </button>
                </div>
            </header>
            
            <!-- Stats -->
            <section class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8" id="stats-bar">
                <div class="stat-card card-modern p-5 flex items-center gap-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-indigo-500/20 to-purple-500/20 flex items-center justify-center">
                        <i data-lucide="database" class="w-7 h-7 text-indigo-400"></i>
                    </div>
                    <div>
                        <p class="text-3xl font-bold text-white" id="total-questions">0</p>
                        <p class="text-sm text-gray-400">×¡×”"×› ×©××œ×•×ª</p>
                    </div>
                </div>
                <div class="stat-card card-modern p-5 flex items-center gap-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-emerald-500/20 to-teal-500/20 flex items-center justify-center">
                        <i data-lucide="check-circle-2" class="w-7 h-7 text-emerald-400"></i>
                    </div>
                    <div>
                        <p class="text-3xl font-bold text-white" id="active-questions">0</p>
                        <p class="text-sm text-gray-400">×¤×¢×™×œ×™×</p>
                    </div>
                </div>
                <div class="stat-card card-modern p-5 flex items-center gap-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-amber-500/20 to-orange-500/20 flex items-center justify-center">
                        <i data-lucide="layers" class="w-7 h-7 text-amber-400"></i>
                    </div>
                    <div>
                        <p class="text-3xl font-bold text-white" id="total-categories">0</p>
                        <p class="text-sm text-gray-400">×§×˜×’×•×¨×™×•×ª</p>
                    </div>
                </div>
                <div class="stat-card card-modern p-5 flex items-center gap-4">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-pink-500/20 to-rose-500/20 flex items-center justify-center">
                        <i data-lucide="sparkles" class="w-7 h-7 text-pink-400"></i>
                    </div>
                    <div>
                        <p class="text-3xl font-bold text-white" id="ai-coverage">0%</p>
                        <p class="text-sm text-gray-400">×›×™×¡×•×™ AI</p>
                    </div>
                </div>
            </section>
            
            <!-- Filters -->
            <section class="glass rounded-3xl p-5 mb-8" id="filters-section">
                <div class="flex flex-wrap items-center gap-4">
                    <div class="flex-1 min-w-64 relative">
                        <i data-lucide="search" class="w-5 h-5 text-gray-400 absolute right-4 top-1/2 -translate-y-1/2"></i>
                        <input type="text" id="search-input" placeholder="×—×¤×© ×©××œ×” ××• ×ª×©×•×‘×”..." class="input-modern w-full pr-12 pl-4 py-4">
                    </div>
                    <select id="category-filter" class="input-modern px-5 py-4 min-w-40">
                        <option value="">×›×œ ×”×§×˜×’×•×¨×™×•×ª</option>
                        <option value="pricing">ğŸ’° ××—×™×¨×™×</option>
                        <option value="services">ğŸ› ï¸ ×©×™×¨×•×ª×™×</option>
                        <option value="hours">ğŸ• ×©×¢×•×ª ×¤×¢×™×œ×•×ª</option>
                        <option value="location">ğŸ“ ××™×§×•×</option>
                        <option value="terms">ğŸ“‹ ×ª× ××™×</option>
                        <option value="faq">â“ ×©××œ×•×ª × ×¤×•×¦×•×ª</option>
                        <option value="other">ğŸ“ ××—×¨</option>
                    </select>
                    <select id="status-filter" class="input-modern px-5 py-4 min-w-32">
                        <option value="">×”×›×œ</option>
                        <option value="active">âœ… ×¤×¢×™×œ×™×</option>
                        <option value="inactive">âŒ ××•×©×‘×ª×™×</option>
                    </select>
                </div>
            </section>
            
            <!-- Knowledge Grid -->
            <section class="grid grid-cols-1 lg:grid-cols-2 gap-5" id="knowledge-grid">
                <div class="card-modern p-6 animate-pulse">
                    <div class="h-6 w-24 bg-white/10 rounded-full mb-4"></div>
                    <div class="h-5 w-full bg-white/10 rounded mb-3"></div>
                    <div class="h-4 w-3/4 bg-white/5 rounded"></div>
                </div>
                <div class="card-modern p-6 animate-pulse">
                    <div class="h-6 w-24 bg-white/10 rounded-full mb-4"></div>
                    <div class="h-5 w-full bg-white/10 rounded mb-3"></div>
                    <div class="h-4 w-3/4 bg-white/5 rounded"></div>
                </div>
            </section>
            
            <!-- Empty State -->
            <div class="hidden text-center py-20" id="empty-state">
                <div class="w-32 h-32 mx-auto mb-8 rounded-full bg-gradient-to-br from-indigo-500/10 to-purple-500/10 flex items-center justify-center">
                    <i data-lucide="brain" class="w-16 h-16 text-indigo-400"></i>
                </div>
                <h3 class="text-2xl font-bold text-white mb-3">×”×‘×•×˜ ×©×œ×š ×¢×“×™×™×Ÿ ×œ× ×™×•×“×¢ ×›×œ×•×</h3>
                <p class="text-gray-400 mb-8 max-w-md mx-auto">×”×•×¡×£ ×©××œ×•×ª ×•×ª×©×•×‘×•×ª ×›×“×™ ×©×”×‘×•×˜ ×™×•×›×œ ×œ×¢× ×•×ª ×œ×œ×§×•×—×•×ª ×©×œ×š</p>
                <div class="flex gap-4 justify-center">
                    <button onclick="openBulkModal()" class="btn-outline px-8 py-4 flex items-center gap-2">
                        <i data-lucide="wand-2" class="w-5 h-5"></i>
                        ×™×™×‘×•× ××”×™×¨
                    </button>
                    <button onclick="openModal()" class="btn-modern text-white px-8 py-4 flex items-center gap-2">
                        <i data-lucide="plus" class="w-5 h-5"></i>
                        ×”×•×¡×£ ×©××œ×” ×¨××©×•× ×”
                    </button>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Add/Edit Modal -->
    <div id="modal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0" onclick="closeModal()"></div>
        <div class="modal-content absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-2xl glass-light rounded-3xl shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between p-6 border-b border-gray-100">
                <h3 class="text-xl font-bold text-dark" id="modal-title">×”×•×¡×£ ×©××œ×” ×—×“×©×”</h3>
                <button onclick="closeModal()" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            <form id="knowledge-form" class="p-6 space-y-5">
                <input type="hidden" id="edit-id">
                <div>
                    <label class="block text-sm font-semibold text-dark mb-2">×§×˜×’×•×¨×™×” *</label>
                    <select id="form-category" required class="w-full px-5 py-4 bg-gray-50 border-2 border-gray-200 rounded-2xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all text-dark">
                        <option value="">×‘×—×¨ ×§×˜×’×•×¨×™×”</option>
                        <option value="pricing">ğŸ’° ××—×™×¨×™×</option>
                        <option value="services">ğŸ› ï¸ ×©×™×¨×•×ª×™×</option>
                        <option value="hours">ğŸ• ×©×¢×•×ª ×¤×¢×™×œ×•×ª</option>
                        <option value="location">ğŸ“ ××™×§×•×</option>
                        <option value="terms">ğŸ“‹ ×ª× ××™×</option>
                        <option value="faq">â“ ×©××œ×•×ª × ×¤×•×¦×•×ª</option>
                        <option value="other">ğŸ“ ××—×¨</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-dark mb-2">×”×©××œ×” *</label>
                    <input type="text" id="form-question" required placeholder='×œ×“×•×’××”: "×›××” ×¢×•×œ×”?"' class="w-full px-5 py-4 bg-gray-50 border-2 border-gray-200 rounded-2xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all text-dark">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-dark mb-2">×”×ª×©×•×‘×” *</label>
                    <textarea id="form-answer" required rows="5" placeholder="×›×ª×•×‘ ×ª×©×•×‘×” ××¤×•×¨×˜×ª..." class="w-full px-5 py-4 bg-gray-50 border-2 border-gray-200 rounded-2xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all resize-none text-dark"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-dark mb-2">××™×œ×•×ª ××¤×ª×—</label>
                    <input type="text" id="form-keywords" placeholder="××—×™×¨, ×¢×œ×•×ª, ×›××” (×”×¤×¨×“ ×‘×¤×¡×™×§×™×)" class="w-full px-5 py-4 bg-gray-50 border-2 border-gray-200 rounded-2xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all text-dark">
                </div>
                <div class="flex items-center justify-between p-5 bg-gray-50 rounded-2xl">
                    <div>
                        <p class="font-semibold text-dark">×©××œ×” ×¤×¢×™×œ×”</p>
                        <p class="text-sm text-gray-500">×”×‘×•×˜ ×™×©×ª××© ×‘×©××œ×” ×”×–×•</p>
                    </div>
                    <div id="form-active" class="toggle-modern active" onclick="toggleActive()"></div>
                </div>
            </form>
            <div class="flex items-center justify-end gap-3 p-6 border-t border-gray-100">
                <button onclick="closeModal()" class="px-6 py-3 text-gray-600 hover:bg-gray-100 rounded-2xl transition-colors font-medium">×‘×™×˜×•×œ</button>
                <button onclick="saveKnowledge()" class="bg-gradient-to-r from-indigo-500 to-purple-500 text-white px-8 py-3 rounded-2xl font-semibold hover:shadow-lg transition-all flex items-center gap-2">
                    <i data-lucide="save" class="w-4 h-4"></i>
                    <span id="save-btn-text">×©××•×¨</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Bulk Import Modal -->
    <div id="bulk-modal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0" onclick="closeBulkModal()"></div>
        <div class="modal-content absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-3xl glass-light rounded-3xl shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between p-6 border-b border-gray-100">
                <div>
                    <h3 class="text-xl font-bold text-dark">×™×™×‘×•× ××”×™×¨ âœ¨</h3>
                    <p class="text-sm text-gray-500 mt-1">×”×“×‘×§ ×˜×§×¡×˜ ×¢× ××™×“×¢ ×¢×œ ×”×¢×¡×§ ×•×”××¢×¨×›×ª ×ª×¡×“×¨ ××•×ª×• ××•×˜×•××˜×™×ª</p>
                </div>
                <button onclick="closeBulkModal()" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-gray-500"></i>
                </button>
            </div>
            <div class="p-6 space-y-5">
                <div>
                    <label class="block text-sm font-semibold text-dark mb-2">×”×“×‘×§ ××ª ×›×œ ×”××™×“×¢ ×¢×œ ×”×¢×¡×§</label>
                    <textarea id="bulk-text" rows="12" placeholder="×œ×“×•×’××”:
××—×™×¨×™×:
×™××›×˜×” ×§×˜× ×” ×¢×“ 8 ×× ×©×™× - 3,500-4,500 ×©×´×—
×™××›×˜×” ×‘×™× ×•× ×™×ª ×¢×“ 15 ×× ×©×™× - 5,000-6,500 ×©×´×—
×™××›×˜×” ×’×“×•×œ×” ×¢×“ 25 ×× ×©×™× - 7,000-9,000 ×©×´×—

×©×¢×•×ª ×¤×¢×™×œ×•×ª:
×™××™× ×-×”: 09:00-18:00
×™×•× ×•: 09:00-14:00
×©×‘×ª: ×¡×’×•×¨

××™×§×•×:
××¨×™× ×” ×”×¨×¦×œ×™×”, ×¨×¦×™×£ 3

××” ×›×•×œ×œ ×”×©×™×™×˜:
×§×¤×˜×Ÿ ××§×¦×•×¢×™, ×“×œ×§, ×¦×™×•×“ ×‘×˜×™×—×•×ª, ××¢×¨×›×ª ×¡××•× ×“" class="w-full px-5 py-4 bg-gray-50 border-2 border-gray-200 rounded-2xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all resize-none text-dark"></textarea>
                </div>
                <div id="bulk-preview" class="hidden">
                    <label class="block text-sm font-semibold text-dark mb-3">×ª×¦×•×’×” ××§×“×™××”</label>
                    <div id="bulk-preview-content" class="space-y-3 max-h-60 overflow-y-auto"></div>
                </div>
            </div>
            <div class="flex items-center justify-end gap-3 p-6 border-t border-gray-100">
                <button onclick="closeBulkModal()" class="px-6 py-3 text-gray-600 hover:bg-gray-100 rounded-2xl transition-colors font-medium">×‘×™×˜×•×œ</button>
                <button onclick="previewBulk()" id="preview-btn" class="bg-gray-800 text-white px-6 py-3 rounded-2xl font-semibold hover:bg-gray-700 transition-all flex items-center gap-2">
                    <i data-lucide="eye" class="w-4 h-4"></i>
                    ×ª×¦×•×’×” ××§×“×™××”
                </button>
                <button onclick="importBulk()" id="import-btn" class="hidden bg-gradient-to-r from-indigo-500 to-purple-500 text-white px-8 py-3 rounded-2xl font-semibold hover:shadow-lg transition-all flex items-center gap-2">
                    <i data-lucide="upload" class="w-4 h-4"></i>
                    ×™×™×‘× ×”×›×œ
                </button>
            </div>
        </div>
    </div>
    
    <!-- Delete Modal -->
    <div id="delete-modal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0" onclick="closeDeleteModal()"></div>
        <div class="modal-content absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md glass-light rounded-3xl shadow-2xl p-8 text-center">
            <div class="w-20 h-20 mx-auto mb-6 bg-red-100 rounded-full flex items-center justify-center">
                <i data-lucide="trash-2" class="w-10 h-10 text-red-500"></i>
            </div>
            <h3 class="text-xl font-bold text-dark mb-2">×œ××—×•×§ ××ª ×”×©××œ×”?</h3>
            <p class="text-gray-500 mb-8">×”×¤×¢×•×œ×” ×”×–×• ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ</p>
            <div class="flex items-center justify-center gap-4">
                <button onclick="closeDeleteModal()" class="px-8 py-3 text-gray-600 hover:bg-gray-100 rounded-2xl transition-colors font-medium">×‘×™×˜×•×œ</button>
                <button onclick="confirmDelete()" class="bg-red-500 text-white px-8 py-3 rounded-2xl font-semibold hover:bg-red-600 transition-all">×›×Ÿ, ××—×§</button>
            </div>
        </div>
    </div>

<script>
const BUSINESS_ID = getBusinessId();
let knowledgeItems = [];
let deleteItemId = null;
let isEditMode = false;
let bulkItems = [];

lucide.createIcons();

async function loadKnowledge() {
    try {
        const db = getSupabase();
        const { data, error } = await db.from('knowledge_base').select('*').eq('business_id', BUSINESS_ID).order('priority', { ascending: false });
        if (error) throw error;
        knowledgeItems = data || [];
        renderKnowledge();
        updateStats();
    } catch (error) {
        console.error('Error:', error);
        showToast('×©×’×™××” ×‘×˜×¢×™× ×ª ×”××™×“×¢', 'error');
    }
}

function renderKnowledge(items = knowledgeItems) {
    const grid = document.getElementById('knowledge-grid');
    const emptyState = document.getElementById('empty-state');
    grid.innerHTML = '';
    
    if (items.length === 0) {
        emptyState.classList.remove('hidden');
        return;
    }
    emptyState.classList.add('hidden');
    
    items.forEach((item, index) => {
        const card = document.createElement('div');
        card.className = `card-modern p-6 ${!item.is_active ? 'opacity-50' : ''}`;
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        const categoryClass = `badge-${item.category}`;
        const categoryLabel = CATEGORY_LABELS[item.category] || item.category;
        
        card.innerHTML = `
            <div class="flex items-start justify-between mb-4">
                <span class="badge ${categoryClass}">${categoryLabel}</span>
                <div class="flex items-center gap-2">
                    ${!item.is_active ? '<span class="text-xs text-gray-400 bg-white/10 px-3 py-1 rounded-full">××•×©×‘×ª</span>' : ''}
                    <div class="relative">
                        <button onclick="toggleMenu('${item.id}')" class="p-2 hover:bg-white/10 rounded-xl transition-colors">
                            <i data-lucide="more-vertical" class="w-4 h-4 text-gray-400"></i>
                        </button>
                        <div id="menu-${item.id}" class="hidden absolute left-0 top-full mt-2 bg-white rounded-2xl shadow-xl border border-gray-100 py-2 min-w-36 z-10">
                            <button onclick="editItem('${item.id}')" class="w-full px-4 py-3 text-right text-sm hover:bg-gray-50 flex items-center gap-3 text-gray-700">
                                <i data-lucide="edit-2" class="w-4 h-4"></i> ×¢×¨×•×š
                            </button>
                            <button onclick="toggleItemActive('${item.id}')" class="w-full px-4 py-3 text-right text-sm hover:bg-gray-50 flex items-center gap-3 text-gray-700">
                                <i data-lucide="${item.is_active ? 'eye-off' : 'eye'}" class="w-4 h-4"></i> ${item.is_active ? '×”×©×‘×ª' : '×”×¤×¢×œ'}
                            </button>
                            <button onclick="deleteItem('${item.id}')" class="w-full px-4 py-3 text-right text-sm hover:bg-red-50 flex items-center gap-3 text-red-500">
                                <i data-lucide="trash-2" class="w-4 h-4"></i> ××—×§
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <h4 class="font-bold text-white text-lg mb-3">${item.question}</h4>
            <p class="text-gray-400 text-sm whitespace-pre-line line-clamp-3">${item.answer}</p>
            ${item.keywords && item.keywords.length > 0 ? `
                <div class="flex flex-wrap gap-2 mt-4">
                    ${item.keywords.slice(0, 4).map(k => `<span class="text-xs bg-white/5 text-gray-300 px-3 py-1 rounded-full">${k}</span>`).join('')}
                    ${item.keywords.length > 4 ? `<span class="text-xs text-gray-500">+${item.keywords.length - 4}</span>` : ''}
                </div>
            ` : ''}
        `;
        
        grid.appendChild(card);
        
        setTimeout(() => {
            card.style.transition = 'all 0.4s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 50);
    });
    
    lucide.createIcons();
}

function updateStats() {
    const total = knowledgeItems.length;
    const active = knowledgeItems.filter(i => i.is_active).length;
    const categories = [...new Set(knowledgeItems.map(i => i.category))].length;
    const coverage = total > 0 ? Math.round((active / total) * 100) : 0;
    
    document.getElementById('total-questions').textContent = total;
    document.getElementById('active-questions').textContent = active;
    document.getElementById('total-categories').textContent = categories;
    document.getElementById('ai-coverage').textContent = coverage + '%';
}

function toggleMenu(id) {
    document.querySelectorAll('[id^="menu-"]').forEach(m => {
        if (m.id !== `menu-${id}`) m.classList.add('hidden');
    });
    document.getElementById(`menu-${id}`).classList.toggle('hidden');
}

document.addEventListener('click', (e) => {
    if (!e.target.closest('[id^="menu-"]') && !e.target.closest('button')) {
        document.querySelectorAll('[id^="menu-"]').forEach(m => m.classList.add('hidden'));
    }
});

function editItem(id) {
    const item = knowledgeItems.find(i => i.id === id);
    if (!item) return;
    
    isEditMode = true;
    document.getElementById('edit-id').value = id;
    document.getElementById('modal-title').textContent = '×¢×¨×•×š ×©××œ×”';
    document.getElementById('save-btn-text').textContent = '×¢×“×›×Ÿ';
    document.getElementById('form-category').value = item.category;
    document.getElementById('form-question').value = item.question;
    document.getElementById('form-answer').value = item.answer;
    document.getElementById('form-keywords').value = (item.keywords || []).join(', ');
    document.getElementById('form-active').classList.toggle('active', item.is_active);
    
    openModal();
}

async function toggleItemActive(id) {
    const item = knowledgeItems.find(i => i.id === id);
    if (!item) return;
    
    try {
        const db = getSupabase();
        await db.from('knowledge_base').update({ is_active: !item.is_active }).eq('id', id);
        item.is_active = !item.is_active;
        renderKnowledge();
        updateStats();
        showToast(item.is_active ? '×”×©××œ×” ×”×•×¤×¢×œ×”' : '×”×©××œ×” ×”×•×©×‘×ª×”');
    } catch (error) {
        showToast('×©×’×™××” ×‘×¢×“×›×•×Ÿ', 'error');
    }
}

function deleteItem(id) {
    deleteItemId = id;
    document.getElementById('delete-modal').classList.remove('hidden');
}

async function confirmDelete() {
    if (!deleteItemId) return;
    
    try {
        const db = getSupabase();
        await db.from('knowledge_base').delete().eq('id', deleteItemId);
        knowledgeItems = knowledgeItems.filter(i => i.id !== deleteItemId);
        renderKnowledge();
        updateStats();
        closeDeleteModal();
        showToast('×”×©××œ×” × ××—×§×”');
    } catch (error) {
        showToast('×©×’×™××” ×‘××—×™×§×”', 'error');
    }
}

function closeDeleteModal() {
    document.getElementById('delete-modal').classList.add('hidden');
    deleteItemId = null;
}

function openModal() {
    document.getElementById('modal').classList.remove('hidden');
    document.body.style.overflow = 'hidden';
    lucide.createIcons();
}

function closeModal() {
    document.getElementById('modal').classList.add('hidden');
    document.body.style.overflow = '';
    resetForm();
}

function resetForm() {
    isEditMode = false;
    document.getElementById('edit-id').value = '';
    document.getElementById('modal-title').textContent = '×”×•×¡×£ ×©××œ×” ×—×“×©×”';
    document.getElementById('save-btn-text').textContent = '×©××•×¨';
    document.getElementById('knowledge-form').reset();
    document.getElementById('form-active').classList.add('active');
}

function toggleActive() {
    document.getElementById('form-active').classList.toggle('active');
}

async function saveKnowledge() {
    const category = document.getElementById('form-category').value;
    const question = document.getElementById('form-question').value.trim();
    const answer = document.getElementById('form-answer').value.trim();
    const keywordsStr = document.getElementById('form-keywords').value.trim();
    const isActive = document.getElementById('form-active').classList.contains('active');
    
    if (!category || !question || !answer) {
        showToast('× × ×œ××œ× ××ª ×›×œ ×”×©×“×•×ª ×”× ×“×¨×©×™×', 'error');
        return;
    }
    
    const keywords = keywordsStr ? keywordsStr.split(',').map(k => k.trim()).filter(k => k) : [];
    const data = { category, question, answer, keywords, is_active: isActive, priority: 5 };
    
    try {
        const db = getSupabase();
        
        if (isEditMode) {
            const id = document.getElementById('edit-id').value;
            await db.from('knowledge_base').update(data).eq('id', id);
            const idx = knowledgeItems.findIndex(i => i.id === id);
            if (idx !== -1) knowledgeItems[idx] = { ...knowledgeItems[idx], ...data };
            showToast('×”×©××œ×” ×¢×•×“×›× ×” ×‘×”×¦×œ×—×”!');
        } else {
            const { data: newItem, error } = await db.from('knowledge_base').insert({ ...data, business_id: BUSINESS_ID }).select().single();
            if (error) throw error;
            knowledgeItems.unshift(newItem);
            showToast('×”×©××œ×” × ×•×¡×¤×” ×‘×”×¦×œ×—×”!');
        }
        
        renderKnowledge();
        updateStats();
        closeModal();
    } catch (error) {
        console.error(error);
        showToast('×©×’×™××” ×‘×©××™×¨×”', 'error');
    }
}

// Bulk Import Functions
function openBulkModal() {
    document.getElementById('bulk-modal').classList.remove('hidden');
    document.body.style.overflow = 'hidden';
    lucide.createIcons();
}

function closeBulkModal() {
    document.getElementById('bulk-modal').classList.add('hidden');
    document.body.style.overflow = '';
    document.getElementById('bulk-text').value = '';
    document.getElementById('bulk-preview').classList.add('hidden');
    document.getElementById('preview-btn').classList.remove('hidden');
    document.getElementById('import-btn').classList.add('hidden');
    bulkItems = [];
}

async function previewBulk() {
    const text = document.getElementById('bulk-text').value.trim();
    if (!text) {
        showToast('× × ×œ×”×–×™×Ÿ ×˜×§×¡×˜', 'warning');
        return;
    }
    
    bulkItems = await autoCategorizeBusiness(text);
    
    if (bulkItems.length === 0) {
        showToast('×œ× × ××¦× ××™×“×¢ ×œ×™×™×‘×', 'warning');
        return;
    }
    
    const previewContent = document.getElementById('bulk-preview-content');
    previewContent.innerHTML = bulkItems.map((item, i) => `
        <div class="flex items-start gap-3 p-4 bg-gray-50 rounded-xl">
            <span class="badge badge-${item.category} text-xs">${CATEGORY_LABELS[item.category] || item.category}</span>
            <div class="flex-1">
                <p class="font-medium text-dark text-sm">${item.question}</p>
                <p class="text-gray-500 text-xs mt-1 line-clamp-2">${item.answer}</p>
            </div>
        </div>
    `).join('');
    
    document.getElementById('bulk-preview').classList.remove('hidden');
    document.getElementById('preview-btn').classList.add('hidden');
    document.getElementById('import-btn').classList.remove('hidden');
    
    showToast(`× ××¦××• ${bulkItems.length} ×¤×¨×™×˜×™× ×œ×™×™×‘×•×`);
}

async function importBulk() {
    if (bulkItems.length === 0) return;
    
    try {
        const db = getSupabase();
        const itemsToInsert = bulkItems.map(item => ({ ...item, business_id: BUSINESS_ID }));
        
        const { data, error } = await db.from('knowledge_base').insert(itemsToInsert).select();
        if (error) throw error;
        
        knowledgeItems = [...data, ...knowledgeItems];
        renderKnowledge();
        updateStats();
        closeBulkModal();
        showToast(`×™×•×‘××• ${data.length} ×©××œ×•×ª ×‘×”×¦×œ×—×”!`);
    } catch (error) {
        console.error(error);
        showToast('×©×’×™××” ×‘×™×™×‘×•×', 'error');
    }
}

// Filters
document.getElementById('search-input').addEventListener('input', filterKnowledge);
document.getElementById('category-filter').addEventListener('change', filterKnowledge);
document.getElementById('status-filter').addEventListener('change', filterKnowledge);

function filterKnowledge() {
    const search = document.getElementById('search-input').value.toLowerCase();
    const category = document.getElementById('category-filter').value;
    const status = document.getElementById('status-filter').value;
    
    let filtered = knowledgeItems;
    
    if (search) {
        filtered = filtered.filter(i => 
            i.question.toLowerCase().includes(search) || 
            i.answer.toLowerCase().includes(search) ||
            (i.keywords || []).some(k => k.toLowerCase().includes(search))
        );
    }
    if (category) filtered = filtered.filter(i => i.category === category);
    if (status === 'active') filtered = filtered.filter(i => i.is_active);
    else if (status === 'inactive') filtered = filtered.filter(i => !i.is_active);
    
    renderKnowledge(filtered);
}

document.addEventListener('DOMContentLoaded', loadKnowledge);
</script>
</body>
</html>
