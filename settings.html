<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyChat - ×”×’×“×¨×•×ª</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    <script>
        tailwind.config = {
            theme: { extend: { colors: { primary: '#6366f1', 'primary-dark': '#4f46e5', secondary: '#8b5cf6', dark: '#0f172a', success: '#10b981', warning: '#f59e0b', danger: '#ef4444' } } }
        }
    </script>
    <style>
        * { font-family: 'Heebo', sans-serif; }
        body { background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%); min-height: 100vh; }
        .glass { background: rgba(255,255,255,0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.08); }
        .glass-light { background: rgba(255,255,255,0.95); }
        .gradient-primary { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); }
        .gradient-glow { box-shadow: 0 0 40px rgba(99, 102, 241, 0.3); }
        .card-modern { background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.06); border-radius: 24px; }
        .sidebar-modern { background: linear-gradient(180deg, rgba(15,23,42,0.98) 0%, rgba(30,41,59,0.98) 100%); border-left: 1px solid rgba(255,255,255,0.06); }
        .sidebar-item { transition: all 0.3s ease; border-radius: 16px; }
        .sidebar-item:hover { background: rgba(99, 102, 241, 0.1); }
        .sidebar-item.active { background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%); border: 1px solid rgba(99, 102, 241, 0.3); }
        .btn-modern { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); border-radius: 16px; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4); }
        .btn-modern:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(99, 102, 241, 0.5); }
        .input-modern { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; color: white; transition: all 0.3s ease; }
        .input-modern:focus { background: rgba(255,255,255,0.08); border-color: #6366f1; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); outline: none; }
        .input-modern::placeholder { color: rgba(255,255,255,0.4); }
        .toggle-modern { position: relative; width: 56px; height: 28px; background: rgba(255,255,255,0.1); border-radius: 14px; cursor: pointer; transition: all 0.3s ease; }
        .toggle-modern.active { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .toggle-modern::after { content: ''; position: absolute; top: 3px; left: 3px; width: 22px; height: 22px; background: white; border-radius: 50%; transition: transform 0.3s ease; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .toggle-modern.active::after { transform: translateX(28px); }
        .pulse-glow { animation: pulseGlow 2s infinite; }
        @keyframes pulseGlow { 0%, 100% { box-shadow: 0 0 5px rgba(16, 185, 129, 0.5); } 50% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.8); } }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.02); }
        ::-webkit-scrollbar-thumb { background: rgba(99, 102, 241, 0.3); border-radius: 3px; }
        .save-indicator { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); z-index: 100; }
    </style>
</head>
<body>
    <div id="toast-container" class="fixed top-4 left-4 z-50 flex flex-col gap-2"></div>
    
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <aside class="sidebar-modern w-72 fixed h-full z-40">
            <div class="p-6 border-b border-white/5">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 gradient-primary rounded-2xl flex items-center justify-center gradient-glow">
                        <i data-lucide="message-square" class="w-6 h-6 text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-white">EasyChat</h1>
                        <p class="text-xs text-gray-400">× ×™×”×•×œ ×‘×•×˜ ×—×›×</p>
                    </div>
                </div>
            </div>
            
            <nav class="p-4 space-y-2">
                <a href="conversations.html" class="sidebar-item flex items-center gap-4 px-5 py-4 text-gray-300 hover:text-white">
                    <i data-lucide="message-circle" class="w-5 h-5"></i>
                    <span class="font-medium">×©×™×—×•×ª</span>
                </a>
                <a href="knowledge.html" class="sidebar-item flex items-center gap-4 px-5 py-4 text-gray-300 hover:text-white">
                    <i data-lucide="brain" class="w-5 h-5"></i>
                    <span class="font-medium">×××’×¨ ××™×“×¢</span>
                </a>
                <a href="settings.html" class="sidebar-item active flex items-center gap-4 px-5 py-4 text-white">
                    <i data-lucide="settings" class="w-5 h-5"></i>
                    <span class="font-medium">×”×’×“×¨×•×ª</span>
                </a>
            </nav>
            
            <div class="absolute bottom-0 w-full p-4 border-t border-white/5">
                <div class="glass rounded-2xl p-4">
                    <div class="flex items-center gap-3">
                        <div class="w-3 h-3 bg-emerald-500 rounded-full pulse-glow"></div>
                        <div>
                            <p class="text-sm font-medium text-white">×‘×•×˜ ×¤×¢×™×œ</p>
                            <p class="text-xs text-gray-400">WhatsApp ××—×•×‘×¨</p>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="flex-1 mr-72 p-8 pb-32">
            <!-- Header -->
            <header class="mb-8" id="header">
                <h2 class="text-3xl font-bold text-white mb-2">×”×’×“×¨×•×ª âš™ï¸</h2>
                <p class="text-gray-400">× ×”×œ ××ª ×”×’×“×¨×•×ª ×”×¢×¡×§ ×•×”×‘×•×˜</p>
            </header>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Main Settings -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Business Info -->
                    <section class="card-modern p-6" id="business-section">
                        <h3 class="text-lg font-bold text-white mb-6 flex items-center gap-3">
                            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500/20 to-purple-500/20 flex items-center justify-center">
                                <i data-lucide="building-2" class="w-5 h-5 text-indigo-400"></i>
                            </div>
                            ×¤×¨×˜×™ ×”×¢×¡×§
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">×©× ×”×¢×¡×§</label>
                                <input type="text" id="business-name" class="input-modern w-full px-5 py-4" placeholder="×©× ×”×¢×¡×§ ×©×œ×š">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">×©× ×‘×¢×œ ×”×¢×¡×§</label>
                                <input type="text" id="owner-name" class="input-modern w-full px-5 py-4" placeholder="×”×©× ×©×œ×š">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">××™××™×™×œ</label>
                                <input type="email" id="email" class="input-modern w-full px-5 py-4" placeholder="email@example.com">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">×˜×œ×¤×•×Ÿ</label>
                                <input type="tel" id="phone" class="input-modern w-full px-5 py-4" placeholder="050-1234567">
                            </div>
                        </div>
                    </section>
                    
                    <!-- Bot Settings -->
                    <section class="card-modern p-6" id="bot-section">
                        <h3 class="text-lg font-bold text-white mb-6 flex items-center gap-3">
                            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-500/20 to-teal-500/20 flex items-center justify-center">
                                <i data-lucide="bot" class="w-5 h-5 text-emerald-400"></i>
                            </div>
                            ×”×’×“×¨×•×ª ×”×‘×•×˜
                        </h3>
                        
                        <div class="space-y-5">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">×©× ×”×‘×•×˜</label>
                                <input type="text" id="bot-name" class="input-modern w-full px-5 py-4" placeholder="×”×¢×•×–×¨ ×”×•×™×¨×˜×•××œ×™">
                                <p class="text-xs text-gray-500 mt-2">×”×©× ×©×”×‘×•×˜ ×™×¦×™×’ ×œ×œ×§×•×—×•×ª</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">×¡×’× ×•×Ÿ ×ª×§×©×•×¨×ª</label>
                                <select id="bot-style" class="input-modern w-full px-5 py-4">
                                    <option value="formal">ğŸ© ×¨×©××™ ×•××§×¦×•×¢×™</option>
                                    <option value="friendly">ğŸ˜Š ×™×“×™×“×•×ª×™ ×•× ×¢×™×</option>
                                    <option value="casual">ğŸ¤™ ×§×–'×•××œ×™ ×•×—×‘×¨×™</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">×”×•×“×¢×ª ×¤×ª×™×—×”</label>
                                <textarea id="welcome-message" rows="3" class="input-modern w-full px-5 py-4 resize-none" placeholder="×©×œ×•×! ğŸ‘‹ ××™×š ××•×›×œ ×œ×¢×–×•×¨?"></textarea>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">×”×•×“×¢×” ×›×©××™×Ÿ ×ª×©×•×‘×”</label>
                                <textarea id="no-answer-message" rows="3" class="input-modern w-full px-5 py-4 resize-none" placeholder="×©××œ×” ××¢×•×œ×”! ××¢×‘×™×¨ ×œ×× ×”×œ..."></textarea>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">×”×•×“×¢×” ××—×•×¥ ×œ×©×¢×•×ª ×¤×¢×™×œ×•×ª</label>
                                <textarea id="out-of-hours-message" rows="3" class="input-modern w-full px-5 py-4 resize-none" placeholder="×× ×—× ×• ×œ× ×–××™× ×™× ×›×¨×’×¢..."></textarea>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Working Hours -->
                    <section class="card-modern p-6" id="hours-section">
                        <h3 class="text-lg font-bold text-white mb-6 flex items-center gap-3">
                            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-amber-500/20 to-orange-500/20 flex items-center justify-center">
                                <i data-lucide="clock" class="w-5 h-5 text-amber-400"></i>
                            </div>
                            ×©×¢×•×ª ×¤×¢×™×œ×•×ª
                        </h3>
                        
                        <div class="space-y-3" id="working-hours">
                            <!-- Will be populated by JS -->
                        </div>
                    </section>
                </div>
                
                <!-- Side Panel -->
                <div class="space-y-6">
                    <!-- WhatsApp Connection -->
                    <section class="card-modern p-6" id="whatsapp-section">
                        <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-3">
                            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-green-500/20 to-emerald-500/20 flex items-center justify-center">
                                <i data-lucide="smartphone" class="w-5 h-5 text-green-400"></i>
                            </div>
                            WhatsApp
                        </h3>
                        
                        <div class="bg-emerald-500/10 border border-emerald-500/20 rounded-2xl p-4 mb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-emerald-500 rounded-xl flex items-center justify-center">
                                    <i data-lucide="check" class="w-6 h-6 text-white"></i>
                                </div>
                                <div>
                                    <p class="font-semibold text-emerald-400">××—×•×‘×¨</p>
                                    <p class="text-sm text-gray-400" id="connected-number">×˜×•×¢×Ÿ...</p>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Plan Info -->
                    <section class="card-modern p-6" id="plan-section">
                        <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-3">
                            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-yellow-500/20 to-amber-500/20 flex items-center justify-center">
                                <i data-lucide="crown" class="w-5 h-5 text-yellow-400"></i>
                            </div>
                            ×”×ª×•×›× ×™×ª
                        </h3>
                        
                        <div class="bg-gradient-to-br from-indigo-500/10 to-purple-500/10 border border-indigo-500/20 rounded-2xl p-5 mb-4">
                            <p class="text-2xl font-bold text-white" id="plan-name">×˜×•×¢×Ÿ...</p>
                            <p class="text-sm text-gray-400" id="plan-status">×˜×•×¢×Ÿ...</p>
                            <div class="mt-4 bg-white/10 rounded-full h-2 overflow-hidden">
                                <div class="gradient-primary h-full transition-all" id="plan-progress" style="width: 0%"></div>
                            </div>
                            <p class="text-xs text-gray-500 mt-2" id="plan-days">×˜×•×¢×Ÿ...</p>
                        </div>
                    </section>
                    
                    <!-- Quick Stats -->
                    <section class="card-modern p-6">
                        <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-3">
                            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-pink-500/20 to-rose-500/20 flex items-center justify-center">
                                <i data-lucide="bar-chart-3" class="w-5 h-5 text-pink-400"></i>
                            </div>
                            ×¡×˜×˜×™×¡×˜×™×§×•×ª
                        </h3>
                        
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-400">×©×™×—×•×ª ×”×—×•×“×©</span>
                                <span class="text-white font-bold" id="stat-conversations">0</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-400">××—×•×– ××¢× ×”</span>
                                <span class="text-emerald-400 font-bold" id="stat-answer-rate">0%</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-400">×©××œ×•×ª ×‘×××’×¨</span>
                                <span class="text-white font-bold" id="stat-knowledge">0</span>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Floating Save Button -->
    <div class="save-indicator hidden" id="save-indicator">
        <button onclick="saveSettings()" class="btn-modern text-white px-8 py-4 flex items-center gap-3 shadow-2xl">
            <i data-lucide="save" class="w-5 h-5"></i>
            ×©××•×¨ ×©×™× ×•×™×™×
        </button>
    </div>

<script>
const BUSINESS_ID = getBusinessId();
const dayNames = {
    sunday: '×¨××©×•×Ÿ',
    monday: '×©× ×™',
    tuesday: '×©×œ×™×©×™',
    wednesday: '×¨×‘×™×¢×™',
    thursday: '×—××™×©×™',
    friday: '×©×™×©×™',
    saturday: '×©×‘×ª'
};

let settings = null;
let originalSettings = null;
let hasChanges = false;

lucide.createIcons();

async function loadSettings() {
    try {
        const db = getSupabase();
        const { data, error } = await db
            .from('businesses')
            .select('*')
            .eq('id', BUSINESS_ID)
            .single();
        
        if (error) throw error;
        settings = data;
        originalSettings = JSON.stringify(data);
        
        populateForm();
        renderWorkingHours();
        loadStats();
        updatePlanInfo();
    } catch (error) {
        console.error('Error:', error);
        showToast('×©×’×™××” ×‘×˜×¢×™× ×ª ×”×”×’×“×¨×•×ª', 'error');
    }
}

function populateForm() {
    if (!settings) return;
    
    document.getElementById('business-name').value = settings.business_name || '';
    document.getElementById('owner-name').value = settings.owner_name || '';
    document.getElementById('email').value = settings.email || '';
    document.getElementById('phone').value = settings.phone || '';
    document.getElementById('bot-name').value = settings.bot_name || '';
    document.getElementById('bot-style').value = settings.bot_style || 'friendly';
    document.getElementById('welcome-message').value = settings.welcome_message || '';
    document.getElementById('no-answer-message').value = settings.no_answer_message || '';
    document.getElementById('out-of-hours-message').value = settings.out_of_hours_message || '';
    document.getElementById('connected-number').textContent = settings.twilio_phone_number ? `+${settings.twilio_phone_number}` : formatPhone(settings.whatsapp_number);
}

function renderWorkingHours() {
    const container = document.getElementById('working-hours');
    const hours = settings?.working_hours || {
        sunday: { active: true, start: '09:00', end: '18:00' },
        monday: { active: true, start: '09:00', end: '18:00' },
        tuesday: { active: true, start: '09:00', end: '18:00' },
        wednesday: { active: true, start: '09:00', end: '18:00' },
        thursday: { active: true, start: '09:00', end: '18:00' },
        friday: { active: true, start: '09:00', end: '14:00' },
        saturday: { active: false, start: '00:00', end: '00:00' }
    };
    
    container.innerHTML = Object.entries(dayNames).map(([day, label]) => {
        const dayHours = hours[day] || { active: false, start: '09:00', end: '18:00' };
        return `
            <div class="flex items-center gap-4 p-4 bg-white/5 rounded-2xl">
                <div class="toggle-modern ${dayHours.active ? 'active' : ''}" onclick="toggleDay('${day}', this)" data-day="${day}"></div>
                <span class="w-16 font-medium text-white">${label}</span>
                <input type="time" value="${dayHours.start}" class="input-modern px-4 py-3 text-sm" data-day="${day}" data-type="start" onchange="markChanged()" ${!dayHours.active ? 'disabled' : ''}>
                <span class="text-gray-500">-</span>
                <input type="time" value="${dayHours.end}" class="input-modern px-4 py-3 text-sm" data-day="${day}" data-type="end" onchange="markChanged()" ${!dayHours.active ? 'disabled' : ''}>
            </div>
        `;
    }).join('');
}

function toggleDay(day, element) {
    element.classList.toggle('active');
    const isActive = element.classList.contains('active');
    
    document.querySelectorAll(`input[data-day="${day}"]`).forEach(input => {
        input.disabled = !isActive;
    });
    
    markChanged();
}

function updatePlanInfo() {
    if (!settings) return;
    
    const planName = settings.plan_type === 'premium' ? 'Premium' : settings.plan_type === 'pro' ? 'Pro' : 'Trial';
    document.getElementById('plan-name').textContent = planName;
    
    if (settings.trial_ends_at) {
        const trialEnd = new Date(settings.trial_ends_at);
        const now = new Date();
        const daysLeft = Math.max(0, Math.ceil((trialEnd - now) / (1000 * 60 * 60 * 24)));
        const progress = Math.min(100, ((14 - daysLeft) / 14) * 100);
        
        document.getElementById('plan-status').textContent = `×ª×§×•×¤×ª × ×™×¡×™×•×Ÿ - ${daysLeft > 0 ? daysLeft + ' ×™××™× × ×•×ª×¨×•' : '×”×¡×ª×™×™×'}`;
        document.getElementById('plan-progress').style.width = progress + '%';
        document.getElementById('plan-days').textContent = daysLeft > 0 ? `× ×•×ª×¨×• ${daysLeft} ×™××™×` : '×ª×§×•×¤×ª ×”× ×™×¡×™×•×Ÿ ×”×¡×ª×™×™××”';
    } else {
        document.getElementById('plan-status').textContent = '×¤×¢×™×œ';
        document.getElementById('plan-progress').style.width = '100%';
        document.getElementById('plan-days').textContent = '';
    }
}

async function loadStats() {
    try {
        const db = getSupabase();
        
        // Get conversations count
        const { count: convCount } = await db
            .from('conversations')
            .select('*', { count: 'exact', head: true })
            .eq('business_id', BUSINESS_ID);
        
        // Get answered count
        const { count: answeredCount } = await db
            .from('conversations')
            .select('*', { count: 'exact', head: true })
            .eq('business_id', BUSINESS_ID)
            .eq('response_type', 'answered');
        
        // Get knowledge count
        const { count: knowledgeCount } = await db
            .from('knowledge_base')
            .select('*', { count: 'exact', head: true })
            .eq('business_id', BUSINESS_ID);
        
        document.getElementById('stat-conversations').textContent = convCount || 0;
        document.getElementById('stat-answer-rate').textContent = convCount > 0 ? Math.round((answeredCount / convCount) * 100) + '%' : '0%';
        document.getElementById('stat-knowledge').textContent = knowledgeCount || 0;
    } catch (error) {
        console.error('Error loading stats:', error);
    }
}

function markChanged() {
    hasChanges = true;
    document.getElementById('save-indicator').classList.remove('hidden');
}

// Listen for changes on all inputs
document.querySelectorAll('input, textarea, select').forEach(el => {
    el.addEventListener('input', markChanged);
    el.addEventListener('change', markChanged);
});

async function saveSettings() {
    // Collect working hours
    const workingHours = {};
    Object.keys(dayNames).forEach(day => {
        const toggle = document.querySelector(`[data-day="${day}"].toggle-modern`);
        const startInput = document.querySelector(`input[data-day="${day}"][data-type="start"]`);
        const endInput = document.querySelector(`input[data-day="${day}"][data-type="end"]`);
        
        workingHours[day] = {
            active: toggle?.classList.contains('active') || false,
            start: startInput?.value || '09:00',
            end: endInput?.value || '18:00'
        };
    });
    
    const updatedSettings = {
        business_name: document.getElementById('business-name').value,
        owner_name: document.getElementById('owner-name').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        bot_name: document.getElementById('bot-name').value,
        bot_style: document.getElementById('bot-style').value,
        welcome_message: document.getElementById('welcome-message').value,
        no_answer_message: document.getElementById('no-answer-message').value,
        out_of_hours_message: document.getElementById('out-of-hours-message').value,
        working_hours: workingHours
    };
    
    try {
        const db = getSupabase();
        const { error } = await db
            .from('businesses')
            .update(updatedSettings)
            .eq('id', BUSINESS_ID);
        
        if (error) throw error;
        
        hasChanges = false;
        document.getElementById('save-indicator').classList.add('hidden');
        showToast('×”×”×’×“×¨×•×ª × ×©××¨×• ×‘×”×¦×œ×—×”! âœ“');
        
        // Update local settings
        settings = { ...settings, ...updatedSettings };
        originalSettings = JSON.stringify(settings);
    } catch (error) {
        console.error('Error:', error);
        showToast('×©×’×™××” ×‘×©××™×¨×ª ×”×”×’×“×¨×•×ª', 'error');
    }
}

// Warn before leaving with unsaved changes
window.addEventListener('beforeunload', (e) => {
    if (hasChanges) {
        e.preventDefault();
        e.returnValue = '';
    }
});

document.addEventListener('DOMContentLoaded', loadSettings);
</script>
</body>
</html>
